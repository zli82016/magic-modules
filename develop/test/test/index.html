<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Add resource tests # This page describes how to add tests to a new resource in the google or google-beta Terraform provider.
For more information about testing, see the official Terraform documentation.
Before you begin # Determine whether your resources is using MMv1 generation or handwritten. If you are not adding tests to an in-progress PR, ensure that your magic-modules, terraform-provider-google, and terraform-provider-google-beta repositories are up to date. cd ~/magic-modules git checkout main && git clean -f ."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="Add resource tests"><meta property="og:description" content="Add resource tests # This page describes how to add tests to a new resource in the google or google-beta Terraform provider.
For more information about testing, see the official Terraform documentation.
Before you begin # Determine whether your resources is using MMv1 generation or handwritten. If you are not adding tests to an in-progress PR, ensure that your magic-modules, terraform-provider-google, and terraform-provider-google-beta repositories are up to date. cd ~/magic-modules git checkout main && git clean -f ."><meta property="og:type" content="article"><meta property="og:url" content="https://googlecloudplatform.github.io/magic-modules/develop/test/test/"><meta property="article:section" content="develop"><meta property="article:modified_time" content="2024-06-11T09:31:58-07:00"><title>Add resource tests | Magic Modules</title><link rel=manifest href=/magic-modules/manifest.json><link rel=icon href=/magic-modules/favicon.png type=image/x-icon><link rel=stylesheet href=/magic-modules/book.min.33a48f5432973b8ff9a82679d9e45d67f2c15d4399bd2829269455cfe390b5e8.css integrity="sha256-M6SPVDKXO4/5qCZ52eRdZ/LBXUOZvSgpJpRVz+OQteg=" crossorigin=anonymous><script defer src=/magic-modules/flexsearch.min.js></script>
<script defer src=/magic-modules/en.search.min.8c332b912757377cfb4e9b45ab590bcd062bc2179bfad02fecaa157dbfb73b68.js integrity="sha256-jDMrkSdXN3z7TptFq1kLzQYrwheb+tAv7KoVfb+3O2g=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/magic-modules/><img src=/magic-modules/magic-modules.svg alt=Logo><span>Magic Modules</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/magic-modules/>Overview</a></li></ul><ul><li><span>Get started</span><ul><li><a href=/magic-modules/get-started/generate-providers/>Generate the providers</a></li><li><a href=/magic-modules/get-started/how-magic-modules-works/>How Magic Modules works</a></li><li><a href=/magic-modules/get-started/contribution-process/>Contribution process</a></li></ul></li><li><span>Develop</span><ul><li><a href=/magic-modules/develop/resource/>Add or modify a resource</a></li><li><a href=/magic-modules/develop/field-reference/>MMv1 field reference</a></li><li><a href=/magic-modules/develop/resource-reference/>MMv1 resource reference</a></li><li><a href=/magic-modules/develop/custom-code/>Add custom resource code</a></li><li><a href=/magic-modules/develop/add-handwritten-datasource/>Add a datasource</a></li><li><a href=/magic-modules/develop/promote-to-ga/>Promote to GA</a></li><li><a href=/magic-modules/develop/permadiff/>Fix a permadiff</a></li><li><input type=checkbox id=section-9ccce47fb686ac21da7c5aafec70c7aa class=toggle checked>
<label for=section-9ccce47fb686ac21da7c5aafec70c7aa class="flex justify-between"><a role=button>Test</a></label><ul><li><a href=/magic-modules/develop/test/test/ class=active>Add resource tests</a></li><li><a href=/magic-modules/develop/test/run-tests/>Run tests</a></li></ul></li><li><input type=checkbox id=section-74c6da531f3d2c4b4f43bdae497559e2 class=toggle>
<label for=section-74c6da531f3d2c4b4f43bdae497559e2 class="flex justify-between"><a role=button>Breaking changes</a></label><ul><li><a href=/magic-modules/develop/breaking-changes/breaking-changes/>Types of breaking changes</a></li><li><a href=/magic-modules/develop/breaking-changes/make-a-breaking-change/>Make a breaking change</a></li></ul></li><li><a href=/magic-modules/develop/handwritten-docs-style-guide/>Handwritten docs style guide</a></li></ul></li><li><a href=/magic-modules/best-practices/>Best practices</a><ul></ul></li><li><span>Contribute</span><ul><li><a href=/magic-modules/contribute/create-pr/>Create a pull request</a></li><li><a href=/magic-modules/contribute/release-notes/>Write release notes</a></li><li><a href=/magic-modules/contribute/review-pr/>Review a pull request</a></li></ul></li><li><span>Reference</span><ul><li><a href=/magic-modules/reference/make-commands/>make commands</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/magic-modules/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Add resource tests</strong>
<label for=toc-control><img src=/magic-modules/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#before-you-begin>Before you begin</a></li><li><a href=#add-a-create-test>Add a create test</a></li><li><a href=#add-an-update-test>Add an update test</a></li><li><a href=#add-unit-tests>Add unit tests</a></li><li><a href=#whats-next>What&rsquo;s next?</a></li></ul></nav></aside></header><article class=markdown><h1 id=add-resource-tests>Add resource tests
<a class=anchor href=#add-resource-tests>#</a></h1><p>This page describes how to add tests to a new resource in the <code>google</code> or <code>google-beta</code> Terraform provider.</p><p>For more information about testing, see the <a href=https://developer.hashicorp.com/terraform/plugin/sdkv2/testing/acceptance-tests>official Terraform documentation</a>.</p><h2 id=before-you-begin>Before you begin
<a class=anchor href=#before-you-begin>#</a></h2><ol><li>Determine whether your resources is using <a href=https://googlecloudplatform.github.io/magic-modules/get-started/how-magic-modules-works/>MMv1 generation or handwritten</a>.</li><li>If you are not adding tests to an in-progress PR, ensure that your <code>magic-modules</code>, <code>terraform-provider-google</code>, and <code>terraform-provider-google-beta</code> repositories are up to date.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd ~/magic-modules
</span></span><span style=display:flex><span>git checkout main <span style=color:#f92672>&amp;&amp;</span> git clean -f . <span style=color:#f92672>&amp;&amp;</span> git checkout -- . <span style=color:#f92672>&amp;&amp;</span> git pull
</span></span><span style=display:flex><span>cd $GOPATH/src/github.com/hashicorp/terraform-provider-google
</span></span><span style=display:flex><span>git checkout main <span style=color:#f92672>&amp;&amp;</span> git clean -f . <span style=color:#f92672>&amp;&amp;</span> git checkout -- . <span style=color:#f92672>&amp;&amp;</span> git pull
</span></span><span style=display:flex><span>cd $GOPATH/src/github.com/hashicorp/terraform-provider-google-beta
</span></span><span style=display:flex><span>git checkout main <span style=color:#f92672>&amp;&amp;</span> git clean -f . <span style=color:#f92672>&amp;&amp;</span> git checkout -- . <span style=color:#f92672>&amp;&amp;</span> git pull
</span></span></code></pre></div></li></ol><h2 id=add-a-create-test>Add a create test
<a class=anchor href=#add-a-create-test>#</a></h2><p>A create test is a test that creates the target resource and immediately destroys it.</p><blockquote><p><strong>Note:</strong> All resources should have a &ldquo;basic&rdquo; create test, which uses the smallest possible number of fields. Additional create tests can be used to ensure all fields on the resource are used in at least one test.</p></blockquote><div class=book-tabs><input type=radio class=toggle name=tabs-create id=tabs-create-0 checked>
<label for=tabs-create-0>MMv1</label><div class="book-tabs-content markdown-inner"><ol><li>Using an editor of your choice, create a <code>*.tf.erb</code> file in <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/templates/terraform/examples><code>mmv1/templates/terraform/examples/</code></a>. The name of the file should include the service name, resource name, and a descriptor. For example, <code>compute_subnetwork_basic.tf.erb</code>.</li><li>Write the Terraform configuration for your test. This should include all of the required dependencies. For example, <code>google_compute_subnetwork</code> has a dependency on <code>google_compute_network</code>:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;google_compute_subnetwork&#34;</span> <span style=color:#e6db74>&#34;primary&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>          = <span style=color:#e6db74>&#34;my-subnet&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ip_cidr_range</span> = <span style=color:#e6db74>&#34;10.1.0.0/16&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>region</span>        = <span style=color:#e6db74>&#34;us-central1&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>network</span>       = <span style=color:#a6e22e>google_compute_network</span>.<span style=color:#a6e22e>network</span>.<span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;google_compute_network&#34;</span> <span style=color:#e6db74>&#34;network&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>                    = <span style=color:#e6db74>&#34;my-network&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>auto_create_subnetworks</span> = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li>If beta-only fields are being tested:<ul><li>Add <code>provider = google-beta</code> to every resource in the file.</li></ul></li><li>Modify the configuration to use templated values.<ul><li>Replace the id of the primary resource you are testing with <code>&lt;%= ctx[:primary_resource_id] %></code>.</li><li>Replace fields that are identifiers, like <code>id</code> or <code>name</code>, with an appropriately named variable. For example, <code>&lt;%= ctx[:vars]['subnetwork_name'] %></code>.</li><li>The resulting configuration for the above example would look like this:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tf data-lang=tf><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;google_compute_subnetwork&#34;</span> <span style=color:#e6db74>&#34;&lt;%= ctx[:primary_resource_id] %&gt;&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>          = <span style=color:#e6db74>&#34;&lt;%= ctx[:vars][&#39;subnetwork_name&#39;] %&gt;&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ip_cidr_range</span> = <span style=color:#e6db74>&#34;10.1.0.0/16&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>region</span>        = <span style=color:#e6db74>&#34;us-central1&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>network</span>       = <span style=color:#a6e22e>google_compute_network</span>.<span style=color:#a6e22e>network</span>.<span style=color:#a6e22e>name</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;google_compute_network&#34;</span> <span style=color:#e6db74>&#34;network&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>                    = <span style=color:#e6db74>&#34;&lt;%= ctx[:vars][&#39;network_name&#39;] %&gt;&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>auto_create_subnetworks</span> = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li>Modify the relevant <code>RESOURCE_NAME.yaml</code> file under <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/products>magic-modules/mmv1/products</a> to include an <a href=https://github.com/GoogleCloudPlatform/magic-modules/blob/main/mmv1/provider/terraform/examples.rb><code>examples</code></a> block with your test. The <code>name</code> must match the name of your <code>*.tf.erb</code> file. For example:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>examples</span>:
</span></span><span style=display:flex><span>  - !<span style=color:#ae81ff>ruby/object:Provider::Terraform::Examples</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#34;compute_subnetwork_basic&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>primary_resource_id</span>: <span style=color:#e6db74>&#34;example&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>vars</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>subnetwork_name</span>: <span style=color:#e6db74>&#34;example-subnet&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>network_name</span>: <span style=color:#e6db74>&#34;example-network&#34;</span>
</span></span></code></pre></div></li></ol><blockquote class="book-hint warning"><strong>Warning:</strong> Values in <code>vars</code> must include a <code>-</code> (or <code>_</code>). They <a href=https://github.com/GoogleCloudPlatform/magic-modules/blob/6858338f013f5dc57729ec037883a3594441ea62/mmv1/provider/terraform/examples.rb#L244>trigger the addition of a <code>tf-test</code> prefix</a>, which the sweeper uses to clean them up after tests run.</blockquote><ol start=6><li>If beta-only fields are being tested:<ul><li>Add <code>min_version: beta</code> to the <code>examples</code> block in <code>RESOURCE_NAME.yaml</code>.</li></ul></li></ol></div><input type=radio class=toggle name=tabs-create id=tabs-create-1>
<label for=tabs-create-1>Handwritten</label><div class="book-tabs-content markdown-inner"><p>This section assumes you&rsquo;ve used the <a href=https://googlecloudplatform.github.io/magic-modules/develop/resource/>Add a resource</a> guide to create your handwritten resource, and you have a working MMv1 config.</p><blockquote><p><strong>Note:</strong> If not, you can create one now, or skip this guide and construct the test by hand. Writing tests by hand can sometimes be a better option if there is a similar test you can copy from.</p></blockquote><ol><li>Add the test in MMv1. Repeat for all the create tests you will need.</li><li><a href=https://googlecloudplatform.github.io/magic-modules/get-started/generate-providers/>Generate the beta provider</a>.</li><li>From the beta provider, copy and paste the generated <code>*_generated_test.go</code> file into the appropriate service folder inside <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/third_party/terraform/services/><code>magic-modules/mmv1/third_party/terraform/services</code></a> as a new file call <code>*_test.go</code>.</li><li>Modify the tests as needed.<ul><li>Replace all occurrences of <code>github.com/hashicorp/terraform-provider-google-beta/google-beta</code> with <code>github.com/hashicorp/terraform-provider-google/google</code></li><li>Remove the comments at the top of the file.</li><li>Remove the <code>Example</code> suffix from all function names.</li><li>If beta-only fields are being tested, do the following:<ul><li>Change the file suffix to <code>.go.erb</code></li><li>Add <code>&lt;% autogen_exception -%></code> to the top of the file</li><li>Wrap each beta-only test in a separate version guard: <code>&lt;% unless version == 'ga' -%>...&lt;% else -%>...&lt;% end -%></code></li></ul></li></ul></li></ol></div></div><h2 id=add-an-update-test>Add an update test
<a class=anchor href=#add-an-update-test>#</a></h2><p>An update test is a test that creates the target resource and then makes updates to fields that are updatable. Updatable fields are fields that can be updated without recreating the entire resource; that is, they are not marked <code>immutable</code> in MMv1 or <code>ForceNew</code> in handwritten code.</p><blockquote><p><strong>Note:</strong> All updatable fields must be covered by at least one update test. In most cases, only a single update test is needed to test all fields at once.</p></blockquote><div class=book-tabs><input type=radio class=toggle name=tabs-update id=tabs-update-0 checked>
<label for=tabs-update-0>MMv1</label><div class="book-tabs-content markdown-inner"><ol><li><a href=https://googlecloudplatform.github.io/magic-modules/get-started/generate-providers/>Generate the beta provider</a>.</li><li>From the beta provider, copy and paste the generated <code>*_generated_test.go</code> file into the appropriate service folder inside <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/third_party/terraform/services><code>magic-modules/mmv1/third_party/terraform/services</code></a> as a new file call <code>*_test.go</code>.</li><li>Using an editor of your choice, delete the <code>*DestroyProducer</code> function, and all but one test. The remaining test should be the &ldquo;full&rdquo; test, or if there is no &ldquo;full&rdquo; test, the &ldquo;basic&rdquo; test. This will be the starting point for your new update test.</li><li>Modify the <code>TestAcc*</code> <em>test function</em> to support updates.<ul><li>Change the suffix of the test function to <code>_update</code>.</li><li>Copy the 2 <code>TestStep</code> blocks and paste them immediately after, so that there are 4 total test steps.</li><li>Change the suffix of the first <code>Config</code> value to <code>_full</code> (or <code>_basic</code>).</li><li>Change the suffix of the second <code>Config</code> value to <code>_update</code>.</li><li>The resulting test function would look similar to this:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestAccPubsubTopic_update</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>   <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>acctest</span>.<span style=color:#a6e22e>VcrTest</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>TestCase</span>{
</span></span><span style=display:flex><span>      <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>Steps</span>: []<span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>TestStep</span>{
</span></span><span style=display:flex><span>         {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Config</span>: <span style=color:#a6e22e>testAccPubsubTopic_full</span>(<span style=color:#f92672>...</span>),
</span></span><span style=display:flex><span>         },
</span></span><span style=display:flex><span>         {
</span></span><span style=display:flex><span>            <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>         },
</span></span><span style=display:flex><span>         {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Config</span>: <span style=color:#a6e22e>testAccPubsubTopic_update</span>(<span style=color:#f92672>...</span>),
</span></span><span style=display:flex><span>         },
</span></span><span style=display:flex><span>         {
</span></span><span style=display:flex><span>            <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>         },
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>   })
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li>Modify the <code>testAcc*</code> Terraform <em>template function</em> to support updates.<ul><li>Copy the template function and paste it immediately after so that there are 2 template functions.</li><li>Change the suffix of the first template function to <code>_full</code> (or <code>_basic</code>).</li><li>Change the suffix of the second template function to <code>_update</code>.</li><li>The resulting template functions would look similar to this:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>testAccPubsubTopic_full</span>(<span style=color:#f92672>...</span>) <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>testAccPubsubTopic_update</span>(<span style=color:#f92672>...</span>) <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li>Modify the test as needed.<ul><li>Replace all occurrences of <code>github.com/hashicorp/terraform-provider-google-beta/google-beta</code> with <code>github.com/hashicorp/terraform-provider-google/google</code></li><li>Modify the template function ending in <code>_update</code> so that updatable fields are changed or removed. This may require additions to the <code>context</code> map in the test function.</li><li>Remove the comments at the top of the file.</li><li>If beta-only fields are being tested, do the following:<ul><li>Change the file suffix to <code>.go.erb</code></li><li>Add <code>&lt;% autogen_exception -%></code> to the top of the file</li><li>Wrap each beta-only test in a separate version guard: <code>&lt;% unless version == 'ga' -%>...&lt;% else -%>...&lt;% end -%></code></li><li>In each beta-only test, ensure that the TestCase sets <code>ProtoV5ProviderFactories: acctest.ProtoV5ProviderBetaFactories(t)</code></li><li>In each beta-only test, ensure that all Terraform resources in all configs have <code>provider = google-beta</code> set</li></ul></li></ul></li></ol></div><input type=radio class=toggle name=tabs-update id=tabs-update-1>
<label for=tabs-update-1>Handwritten</label><div class="book-tabs-content markdown-inner"><ol><li>Using an editor of your choice, open the existing <code>*_test.go</code> or <code>*_test.go.erb</code> file in the appropriate service folder inside <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/third_party/terraform/services><code>magic-modules/mmv1/third_party/terraform/services</code></a> which contains your create tests.</li><li>Copy the <code>TestAcc*</code> <em>test function</em> for the existing &ldquo;full&rdquo; test. If there is no &ldquo;full&rdquo; test, use the &ldquo;basic&rdquo; test. This will be the starting point for your new update test.</li><li>Modify the test function to support updates.<ul><li>Change the suffix of the test function to <code>_update</code>.</li><li>Copy the 2 <code>TestStep</code> blocks and paste them immediately after, so that there are 4 total test steps.</li><li>Change the suffix of the second <code>Config</code> value to <code>_update</code>.</li><li>The resulting test function would look similar to this:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestAccPubsubTopic_update</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>   <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>acctest</span>.<span style=color:#a6e22e>VcrTest</span>(<span style=color:#a6e22e>t</span>, <span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>TestCase</span>{
</span></span><span style=display:flex><span>      <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>Steps</span>: []<span style=color:#a6e22e>resource</span>.<span style=color:#a6e22e>TestStep</span>{
</span></span><span style=display:flex><span>         {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Config</span>: <span style=color:#a6e22e>testAccPubsubTopic_full</span>(<span style=color:#f92672>...</span>),
</span></span><span style=display:flex><span>         },
</span></span><span style=display:flex><span>         {
</span></span><span style=display:flex><span>            <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>         },
</span></span><span style=display:flex><span>         {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>Config</span>: <span style=color:#a6e22e>testAccPubsubTopic_update</span>(<span style=color:#f92672>...</span>),
</span></span><span style=display:flex><span>         },
</span></span><span style=display:flex><span>         {
</span></span><span style=display:flex><span>            <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>         },
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>   })
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li>Add a Terraform <em>template function</em> to support updates.<ul><li>Copy the full (or basic) <code>testAcc*</code> template function.</li><li>Change the suffix of the new template function to <code>_update</code>.</li><li>The new template function would look similar to this:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>testAccPubsubTopic_update</span>(<span style=color:#f92672>...</span>) <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li>Modify the test as needed.<ul><li>Modify the new template function so that updatable fields are changed or removed. This may require additions to the <code>context</code> map in the test function.</li><li>Remove the comments at the top of the file.</li><li>If beta-only fields are being tested, do the following:<ul><li>Change the file suffix to <code>.go.erb</code></li><li>Add <code>&lt;% autogen_exception -%></code> to the top of the file</li><li>Wrap each beta-only test in a separate version guard: <code>&lt;% unless version == 'ga' -%>...&lt;% else -%>...&lt;% end -%></code></li><li>In each beta-only test, ensure that the TestCase sets <code>ProtoV5ProviderFactories: acctest.ProtoV5ProviderBetaFactories(t)</code></li><li>In each beta-only test, ensure that all Terraform resources in all configs have <code>provider = google-beta</code> set</li></ul></li></ul></li></ol></div></div><h2 id=add-unit-tests>Add unit tests
<a class=anchor href=#add-unit-tests>#</a></h2><p>A unit test verifies functionality that is not related to interactions with the API, such as
<a href=https://googlecloudplatform.github.io/magic-modules/develop/field-reference/#diff_suppress_func>diff suppress functions</a>,
<a href=https://googlecloudplatform.github.io/magic-modules/develop/field-reference/#validation>validation functions</a>,
CustomizeDiff functions, and so on.</p><p>Unit tests should be added to the appropriate folder in <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/third_party/terraform/services><code>magic-modules/mmv1/third_party/terraform/services</code></a> in the file called <code>resource_PRODUCT_RESOURCE_test.go</code>. (You may need to create this file if it does not already exist. Replace PRODUCT with the product name and RESOURCE with the resource name; it should match the name of the generated resource file.)</p><p>Unit tests should be named like <code>TestFunctionName</code> - for example, <code>TestDiskImageDiffSuppress</code> would contain tests for the <code>DiskImageDiffSuppress</code> function.</p><p>Example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestSignatureAlgorithmDiffSuppress</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>   <span style=color:#a6e22e>cases</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>Old</span>, <span style=color:#a6e22e>New</span>           <span style=color:#66d9ef>string</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>ExpectDiffSuppress</span> <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>   }{
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;ECDSA_P256 equivalent&#34;</span>: {
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>Old</span>:                <span style=color:#e6db74>&#34;ECDSA_P256_SHA256&#34;</span>,
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>New</span>:                <span style=color:#e6db74>&#34;EC_SIGN_P256_SHA256&#34;</span>,
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>ExpectDiffSuppress</span>: <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>      <span style=color:#75715e>// Additional cases excluded for brevity
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>   }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>tn</span>, <span style=color:#a6e22e>tc</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>cases</span> {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>signatureAlgorithmDiffSuppress</span>(<span style=color:#e6db74>&#34;signature_algorithm&#34;</span>, <span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>Old</span>, <span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>New</span>, <span style=color:#66d9ef>nil</span>) <span style=color:#f92672>!=</span> <span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>ExpectDiffSuppress</span> {
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;bad: %s, %q =&gt; %q expect DiffSuppress to return %t&#34;</span>, <span style=color:#a6e22e>tn</span>, <span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>Old</span>, <span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>New</span>, <span style=color:#a6e22e>tc</span>.<span style=color:#a6e22e>ExpectDiffSuppress</span>)
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=whats-next>What&rsquo;s next?
<a class=anchor href=#whats-next>#</a></h2><ul><li><a href=https://googlecloudplatform.github.io/magic-modules/develop/test/run-tests/>Run your tests</a></li></ul></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/GoogleCloudPlatform/magic-modules/commit/524a2a827a32a2365f2dc708d8f3aef3fa7abe54 title='Last modified by Stephen Lewis (Burrows) | June 11, 2024' target=_blank rel=noopener><img src=/magic-modules/svg/calendar.svg class=book-icon alt=Calendar>
<span>June 11, 2024</span></a></div><div><a class="flex align-center" href="https://github.com/hashicorp/terraform-provider-google/issues/new?assignees=&labels=technical-debt,documentation&projects=&title=MM%20docsite%20issue%20in%20content/develop%2ftest%2ftest.md&template=11_developer_productivity.md" target=_blank rel=noopener><img src=/magic-modules/report.svg class=book-icon alt=Edit>
<span>Report documentation issue</span></a></div><div><a class="flex align-center" href=https://github.com/GoogleCloudPlatform/magic-modules/edit/main/docs/content/develop/test/test.md target=_blank rel=noopener><img src=/magic-modules/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#before-you-begin>Before you begin</a></li><li><a href=#add-a-create-test>Add a create test</a></li><li><a href=#add-an-update-test>Add an update test</a></li><li><a href=#add-unit-tests>Add unit tests</a></li><li><a href=#whats-next>What&rsquo;s next?</a></li></ul></nav></div></aside></main></body></html>