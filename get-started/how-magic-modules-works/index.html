<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="How Magic Modules works # Magic Modules can be thought of as a source of truth for how to map a GCP API resource representation to a Terraform resource (or datasource) representation. Magic Modules uses that mapping (and additional handwritten code where necessary) to generate &ldquo;downstream&rdquo; repositories - in particular, the Terraform providers for Google Cloud: google (or TPG) and google-beta (or TPGB).
Generation of the downstream repositories happens for every new commit in a PR (to a temporary branch owned by the modular-magician robot user) and on every merge into the main branch (to the main branch of downstreams)."><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content="How Magic Modules works"><meta property="og:description" content="How Magic Modules works # Magic Modules can be thought of as a source of truth for how to map a GCP API resource representation to a Terraform resource (or datasource) representation. Magic Modules uses that mapping (and additional handwritten code where necessary) to generate &ldquo;downstream&rdquo; repositories - in particular, the Terraform providers for Google Cloud: google (or TPG) and google-beta (or TPGB).
Generation of the downstream repositories happens for every new commit in a PR (to a temporary branch owned by the modular-magician robot user) and on every merge into the main branch (to the main branch of downstreams)."><meta property="og:type" content="article"><meta property="og:url" content="https://googlecloudplatform.github.io/magic-modules/get-started/how-magic-modules-works/"><meta property="article:section" content="get-started"><meta property="article:modified_time" content="2024-03-04T09:38:25-08:00"><title>How Magic Modules works | Magic Modules</title><link rel=manifest href=/magic-modules/manifest.json><link rel=icon href=/magic-modules/favicon.png type=image/x-icon><link rel=stylesheet href=/magic-modules/book.min.33a48f5432973b8ff9a82679d9e45d67f2c15d4399bd2829269455cfe390b5e8.css integrity="sha256-M6SPVDKXO4/5qCZ52eRdZ/LBXUOZvSgpJpRVz+OQteg=" crossorigin=anonymous><script defer src=/magic-modules/flexsearch.min.js></script>
<script defer src=/magic-modules/en.search.min.0f5abebea7e0cb821afa4dd8a42c30ed905606d53566265ff978a772a5633c95.js integrity="sha256-D1q+vqfgy4Ia+k3YpCww7ZBWBtU1ZiZf+XincqVjPJU=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/magic-modules/><img src=/magic-modules/magic-modules.svg alt=Logo><span>Magic Modules</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><a href=/magic-modules/>Overview</a></li></ul><ul><li><span>Get started</span><ul><li><a href=/magic-modules/get-started/generate-providers/>Generate the providers</a></li><li><a href=/magic-modules/get-started/how-magic-modules-works/ class=active>How Magic Modules works</a></li><li><a href=/magic-modules/get-started/contribution-process/>Contribution process</a></li></ul></li><li><span>Develop</span><ul><li><a href=/magic-modules/develop/resource/>Add or modify a resource</a></li><li><a href=/magic-modules/develop/field-reference/>MMv1 field reference</a></li><li><a href=/magic-modules/develop/custom-code/>Add custom resource code</a></li><li><a href=/magic-modules/develop/add-handwritten-datasource/>Add a datasource</a></li><li><a href=/magic-modules/develop/promote-to-ga/>Promote to GA</a></li><li><a href=/magic-modules/develop/permadiff/>Fix a permadiff</a></li><li><input type=checkbox id=section-9ccce47fb686ac21da7c5aafec70c7aa class=toggle>
<label for=section-9ccce47fb686ac21da7c5aafec70c7aa class="flex justify-between"><a role=button>Test</a></label><ul><li><a href=/magic-modules/develop/test/test/>Add resource tests</a></li><li><a href=/magic-modules/develop/test/run-tests/>Run tests</a></li></ul></li><li><input type=checkbox id=section-74c6da531f3d2c4b4f43bdae497559e2 class=toggle>
<label for=section-74c6da531f3d2c4b4f43bdae497559e2 class="flex justify-between"><a role=button>Breaking changes</a></label><ul><li><a href=/magic-modules/develop/breaking-changes/breaking-changes/>Types of breaking changes</a></li><li><a href=/magic-modules/develop/breaking-changes/make-a-breaking-change/>Make a breaking change</a></li></ul></li><li><a href=/magic-modules/develop/handwritten-docs-style-guide/>Handwritten docs style guide</a></li></ul></li><li><a href=/magic-modules/best-practices/>Best practices</a><ul></ul></li><li><span>Contribute</span><ul><li><a href=/magic-modules/contribute/create-pr/>Create a pull request</a></li><li><a href=/magic-modules/contribute/release-notes/>Write release notes</a></li><li><a href=/magic-modules/contribute/review-pr/>Review a pull request</a></li></ul></li><li><span>Reference</span><ul><li><a href=/magic-modules/reference/make-commands/>make commands</a></li><li><a href=https://github.com/GoogleCloudPlatform/magic-modules/blob/main/mmv1/api/resource.rb target=_blank rel=noopener>Resource YAML reference ↗</a></li><li><a href=https://github.com/GoogleCloudPlatform/magic-modules/blob/main/mmv1/api/resource/iam_policy.rb target=_blank rel=noopener>IAM policy YAML reference ↗</a></li></ul></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/magic-modules/svg/menu.svg class=book-icon alt=Menu></label>
<strong>How Magic Modules works</strong>
<label for=toc-control><img src=/magic-modules/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#resource-types>Resource types</a><ul><li><a href=#mmv1>MMv1</a></li><li><a href=#handwritten>Handwritten</a></li><li><a href=#dcl-aka-tpgtools-maintenance-mode>DCL aka tpgtools (maintenance mode)</a></li></ul></li></ul></nav></aside></header><article class=markdown><h1 id=how-magic-modules-works>How Magic Modules works
<a class=anchor href=#how-magic-modules-works>#</a></h1><p>Magic Modules can be thought of as a source of truth for how to map a GCP API resource representation to a Terraform resource (or datasource) representation. Magic Modules uses that mapping (and additional handwritten code where necessary) to generate &ldquo;downstream&rdquo; repositories - in particular, the Terraform providers for Google Cloud: <a href=https://github.com/hashicorp/terraform-provider-google><code>google</code></a> (or TPG) and <a href=https://github.com/hashicorp/terraform-provider-google-beta><code>google-beta</code></a> (or TPGB).</p><p>Generation of the downstream repositories happens for every new commit in a PR (to a temporary branch owned by the <a href=https://github.com/modular-magician/><code>modular-magician</code></a> robot user) and on every merge into the main branch (to the main branch of downstreams). Generation for PR commits allows contributors to manually examine the changes, as well as allowing automatic running of unit tests, acceptance tests, and automated checks such as breaking change detection.</p><h2 id=resource-types>Resource types
<a class=anchor href=#resource-types>#</a></h2><p>There are three types of resources supported by Magic Modules: MMv1, Handwritten, and DCL/tpgtools. These are described in more detail in the following sections.</p><h3 id=mmv1>MMv1
<a class=anchor href=#mmv1>#</a></h3><p>MMv1 consists of a set of &ldquo;products&rdquo;; each product contains one or more &ldquo;resources&rdquo;.</p><p>Each product has a folder in <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/products><code>magic-modules/mmv1/products</code></a>. The name of the folder is the &ldquo;product name&rdquo;, which usually corresponds to the API subdomain covered by the product (such as <code>compute.googleapis.com</code>). Each product folder contains a product configuration file (<code>product.yaml</code>) and one or more resource configuration files (<code>ResourceName.yaml</code>). The actual name of a <code>ResourceName.yaml</code> file usually matches the name of a GCP API resource in the product&rsquo;s subdomain.</p><p>MMv1 resource configurations may reference handwritten code stored in <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/templates/terraform><code>magic-modules/mmv1/templates/terraform</code></a>, which will be injected into the generated resource file. Many MMv1 resources also have one or more handwritten tests, which are stored in the appropriate service folder inside <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/third_party/terraform/services><code>magic-modules/mmv1/third_party/terraform/services</code></a></p><p>In the providers, MMv1-based resources are stored in <code>PROVIDER/services/PRODUCT/resource_PRODUCT_RESOURCE.go</code>, where <code>PROVIDER</code> is <code>google</code> or <code>google-beta</code>, <code>PRODUCT</code> is the product name, and RESOURCE is the GCP API resource&rsquo;s name converted to <a href=https://en.wikipedia.org/wiki/Snake_case>snake case ↗</a>.</p><p>MMv1-based files start with the following header:</p><pre tabindex=0><code>***     AUTO GENERATED CODE    ***    Type: MMv1     ***
</code></pre><h3 id=handwritten>Handwritten
<a class=anchor href=#handwritten>#</a></h3><p>Handwritten resources and datasources are technically part of MMv1; however, they are not generated from YAML configurations. Instead, they are written as Go code with minimal ruby &ldquo;version guards&rdquo; to exclude beta-only features from the <code>google</code> provider.</p><p>Handwritten resources and datasources can be grouped by &ldquo;service&rdquo;, which generally corresponds to the API subdomain the resource or datasource interacts with.</p><p>In addition to the core implementation, handwritten resources and datasources will also have documentation, tests, and sweepers (which clean up stray resources left behind by tests). Each type of code is stored in the following locations:</p><ul><li>Resource & datasource implementation: In the appropriate service folder inside <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/third_party/terraform/services><code>magic-modules/mmv1/third_party/terraform/services</code></a></li><li>Resource documentation: <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/third_party/terraform/website/docs/r><code>magic-modules/mmv1/third_party/terraform/website/docs/r</code></a></li><li>Datasource documentation: <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/third_party/terraform/website/docs/d><code>magic-modules/mmv1/third_party/terraform/website/docs/d</code></a></li><li>Tests: In the appropriate service folder inside <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/third_party/terraform/services><code>magic-modules/mmv1/third_party/terraform/services</code></a></li><li>Sweepers: <a href=https://github.com/GoogleCloudPlatform/magic-modules/tree/main/mmv1/third_party/terraform/utils><code>magic-modules/mmv1/third_party/terraform/utils</code></a></li></ul><p>In the providers, handwritten resources and datasources are stored in <code>PROVIDER/services/SERVICE/FILENAME.go</code>, where <code>PROVIDER</code> is <code>google</code> or <code>google-beta</code>, <code>SERVICE</code> is the service name, and <code>FILENAME</code> is the name of the handwritten file in magic-modules. Handwritten files do not have an <code>AUTO GENERATED CODE</code> header.</p><h3 id=dcl-aka-tpgtools-maintenance-mode>DCL aka tpgtools (maintenance mode)
<a class=anchor href=#dcl-aka-tpgtools-maintenance-mode>#</a></h3><p>DCL / tpgtools is similar to MMv1; however, it is in maintenance mode, which means that new resources using the DCL are not being added.</p><p>DCL-based files start with the following header:</p><pre tabindex=0><code>***     AUTO GENERATED CODE    ***    Type: DCL     ***
</code></pre></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/GoogleCloudPlatform/magic-modules/commit/9f98cde4b2e5946ec446d572c08d0ea15dfb6a57 title='Last modified by Riley Karson | March 4, 2024' target=_blank rel=noopener><img src=/magic-modules/svg/calendar.svg class=book-icon alt=Calendar>
<span>March 4, 2024</span></a></div><div><a class="flex align-center" href="https://github.com/hashicorp/terraform-provider-google/issues/new?assignees=&labels=technical-debt,documentation&projects=&title=MM%20docsite%20issue%20in%20content/get-started%2fhow-magic-modules-works.md&template=11_developer_productivity.md" target=_blank rel=noopener><img src=/magic-modules/report.svg class=book-icon alt=Edit>
<span>Report documentation issue</span></a></div><div><a class="flex align-center" href=https://github.com/GoogleCloudPlatform/magic-modules/edit/main/docs/content/get-started/how-magic-modules-works.md target=_blank rel=noopener><img src=/magic-modules/svg/edit.svg class=book-icon alt=Edit>
<span>Edit this page</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#resource-types>Resource types</a><ul><li><a href=#mmv1>MMv1</a></li><li><a href=#handwritten>Handwritten</a></li><li><a href=#dcl-aka-tpgtools-maintenance-mode>DCL aka tpgtools (maintenance mode)</a></li></ul></li></ul></nav></div></aside></main></body></html>