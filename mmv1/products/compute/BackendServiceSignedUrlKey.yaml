# Copyright 2024 Google Inc.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

---
name: BackendServiceSignedUrlKey
api_resource_type_kind: BackendService
description: |
  A key for signing Cloud CDN signed URLs for Backend Services.
references:
  guides:
    Using Signed URLs: https://cloud.google.com/cdn/docs/using-signed-urls/
  api: https://cloud.google.com/compute/docs/reference/rest/v1/backendServices
base_url: projects/{{project}}/global/backendServices/{{backend_service}}
immutable: true
self_link: projects/{{project}}/global/backendServices/{{backend_service}}
create_url: projects/{{project}}/global/backendServices/{{backend_service}}/addSignedUrlKey
delete_url: projects/{{project}}/global/backendServices/{{backend_service}}/deleteSignedUrlKey?keyName={{name}}
delete_verb: POST
identity:
  - name
nested_query:
  keys:
    - cdnPolicy
    - signedUrlKeyNames
  is_list_of_ids: true
  modify_by_patch: false
kind: compute#BackendServiceSignedUrlKey
mutex: signedUrlKey/{{project}}/backendServices/{{backend_service}}/
exclude_import: true
async:
  operation:
    base_url: '{{op_id}}'
exclude_tgc: true
examples:
  - name: backend_service_signed_url_key
    primary_resource_id: backend_key
    exclude_test: true
    vars:
      backend_name: my-backend-service
      igm_name: my-webservers
      key_name: test-key
    external_providers:
      - random
      - time
parameters:
  - name: backendService
    type: ResourceRef
    required: true
    description: |
      The backend service this signed URL key belongs.
    immutable: true
    resource: BackendService
    imports: name
    ignore_read: true
    custom_expand: templates/terraform/custom_expand/resourceref_with_validation.go.tmpl
properties:
  - name: name
    api_name: keyName
    type: String
    required: true
    description: |
      Name of the signed URL key.
    immutable: true
    validation:
      regex: ^(?:[a-z](?:[-a-z0-9]{0,61}[a-z0-9])?)$
  - name: keyValue
    type: String
    required: true
    description: |
      128-bit key value used for signing the URL. The key value must be a
      valid RFC 4648 Section 5 base64url encoded string.
    immutable: true
    sensitive: true
    ignore_read: true
